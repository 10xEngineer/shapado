!!! Strict
%html{ "xml:lang" => "en", :lang => "en", :xmlns => "http://www.w3.org/1999/xhtml" }
  %head
    %meta{ :content => "text/html; charset=utf-8", "http-equiv" => "Content-Type" }
    %title
      Shapado - Questions & Answers
    %meta{ :name => "description", :content => "" }
    %meta{ :name => "keywords", :content => "" }
    %link{:rel=>"icon", :type=>"image/png", :href=>"/favicon.ico"}

    = javascript_include_tag "jquery", "jquery-ui", "showdown", "jquery.textarea", "application"
    = javascript_include_tag 'jquery.droppy'
    = javascript_include_tag 'modules/sessions.js'
    = javascript_include_tag 'openid/js/jquery.openid.min.js'

    = stylesheet_link_tag 'compiled/grid.css', :media => 'screen, projection'
    = stylesheet_link_tag 'compiled/application.css', :media => 'screen, projection'
    = stylesheet_link_tag 'compiled/markdown_editor.css', :media => 'screen, projection'
    = stylesheet_link_tag 'compiled/components/droppy.css', :media => 'screen, projection'
    = stylesheet_link_tag '/javascripts/openid/css/style.css', :media => 'screen, projection'

  %body
    .two-column
      #header
        #logo
          %a{:href => root_path}
            =image_tag "logo.png", :height => "45", :alt => "Shapado"
          %ul#menu_logo
            %li
              = link_to "FAQ", questions_path(:tags => "faq")
            %li
              -if @category
                = link_to category_desc(@category), "/"
              -else
                = link_to t("views.layout.categories"), request.domain
              %ul
                -category_options.each do |desc, value|
                  %li
                    = link_to(desc, tag_url(value))
            %li
              -if @languages && !@languages.empty?
                = link_to language_desc(@languages.first), ""
              -else
                = link_to t("views.layout.languages"), request.domain
              %ul
                -if logged_in?
                  -languages_options(current_user.preferred_languages).each do |desc, value|
                    %li
                      = link_to desc, tag_url(value)
                -else
                  -languages_options.each do |desc, value|
                    %li
                      = link_to desc, tag_url(value)


        #user-actions
          #user-nav
            -if logged_in?
              .left{:style =>"text-align: right"}
                = I18n.t('views.layout.logged', :default => "Logged in as {{login}}", :login => h(current_user.login))
                =link_to I18n.t('views.layout.logout'), logout_path
                =link_to I18n.t('views.layout.settings'), settings_path
              .box.right
                -form_tag search_path, :class => "form", :method => :get do
                  %fieldset
                    %p
                      = text_field_tag 'q', params[:q], :class => "text-field"
                  .buttons
                    %button{:type => "submit"}
                      = I18n.t('views.layout.search', :default => "Go")
      .clear
      %br
      #navigation{:class => "#{@active_tab}"}
        #menu_primary
          %ul
            %li.questions
              =link_to I18n.t("views.layout.questions"), questions_path
            %li.tags
              =link_to I18n.t("views.layout.tags"), tags_questions_path
            %li.users
              =link_to I18n.t("views.layout.users"), users_path
            %li.unanswered
              =link_to I18n.t("views.layout.unanswered"), unanswered_questions_path
            -if logged_in?
              -current_user.preferred_tags.each do |tag|
                %li{:class => (@active_tag == "tag_#{tag}" ? 'selected' : '' ) }
                  =link_to h(tag), questions_path(:tags => tag)
            %li.ask_question
              =link_to I18n.t("views.layout.ask_question"), new_question_path
      #main-content
        -flash.each do |k,v|
          .message{:class => k.to_s}
            .internal
              = h(v)
        #layout
          #content
            .internal
              -if !logged_in?
                .box.highlight
                  -form_tag session_path, :id => 'openid' do
                    &nbsp;
              %br
              = yield
          #sidebar
            .internal
              .questions_count
                -if @questions
                  -if @question.respond_to?(:total_entries)
                    = number_with_delimiter(@questions.total_entries)
                  -else
                    = number_with_delimiter(@questions.size)
                -else
                  = number_with_delimiter(Question.count(language_conditions))
              %p
                questions
              = yield :sidebar
      #footer
        %hr
        %p
          \&copy; 2009 Ricodigo. Some rights reserved.
      .clear
  - if ENV["RAILS_ENV"] == "production"
    :erb

      <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script>
      <script type="text/javascript">
      try {
      var pageTracker = _gat._getTracker("UA-10385211-1");
      pageTracker._trackPageview();
      } catch(err) {}</script>
